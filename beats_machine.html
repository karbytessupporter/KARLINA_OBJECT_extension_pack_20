<!--
/**
 * file: beats_machine.html
 * type: Hyper-Text-Markup-Language
 * author: karbytes
 * date: 09_SEPTEMBER_2024
 * license: PUBLIC_DOMAIN
 */
 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BEATS_MACHINE</title>
    <!-- 
        /**
         * The linked Cascading-Style-Sheet file named karbytes_aesthetic.css 
         * defines how this web page (which is named beats_machine.html) appears 
         * when this web page is (re)loaded by the web browser. 
         */
     -->
    <link rel="stylesheet" href="karbytes_aesthetic.css">
    <!-- 
        /**
         * The linked JavaScript file named beats_machine.js 
         * defines how this web page (which is named beats_machine.html) behaves 
         * when the user clicks on the menus and start and stop buttons 
         * (and when this web page is (re)loaded by the web browser). 
         */
     -->
    <script src="beats_machine.js"></script>
    <style>
        /** Give DIV elements on this web page rounded corners and a MAGENTA border which is 2 pixels thick. */
        div {
            border-color: #ff00ff;
            border-width: 2px;
            border-style: solid;
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
        }
        /** 
         * Set the button elements on this web page to have a similar visual appearance as other HTML elements 
         * defined in the linked Cascading-Style-Sheet file (i.e. karbytes_aesthetic.css). 
         */
        button {
            border-color: #ff9000;
            border-width: 2px;
            border-style: solid;
            background: #00ff00;
            color: #000000;
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            font-size: 14pt;
        }
        /** Set the start button's background color to GREEN. */
        #start_button {
            background: #00ff00;
        }
        /** Set the stop button's background color to RED. */
        #stop_button {
            background: #ff0000;
        }
        /** Cause the start button's background color to turn CYAN when the cursor hovers over it. */
        #start_button:hover {
            background: #00ffff;
        }
        /** Cause the stop button's background color to turn CYAN when the cursor hovers over it. */
        #stop_button:hover {
            background: #00ffff;
        }
    </style>
</head>
<body onload="initialize_application()">
    <div>
        <h1>BEATS_MACHINE</h1>
        <p>
            This application plays zero, one, two, or three sound tracks simultaneously and such that the 
            user can customize the beat pitch (i.e. monotone sound wave frequency) and the beat duration 
            (i.e. time interval in which the same tone is played immediately in succession) of each one 
            of those three sound tracks.
        </p>
    </div>

    <!-- Track 1 -->
    <div>
        <h3>Track 1</h3>
        <label for="track1-duration">Select Beat Duration:</label>
        <select id="track1-duration">
            <option value="0.0625">1/16 second (i.e. 0.0625 second)</option>
            <option value="0.25">1/4 second (i.e. 0.25 second)</option>
            <option value="0.5">1/2 second (i.e. 0.5 second)</option>
            <option value="0.75">3/4 second (i.e. 0.75 second)</option>
            <option value="1">1 second</option>
            <option value="1.0625">17/16 seconds (i.e. 1.0625 second)</option>
            <option value="1.25">5/4 seconds (i.e. 1.25 seconds)</option>
            <option value="1.5">3/2 seconds (i.e. 1.5 seconds</option>
            <option value="1.75">7/4 seconds (i.e. 1.75 seconds)</option>
            <option value="2">2 seconds</option>
        </select>
        <br><br>
        <label for="track1-pitch">Select Beat Pitch:</label>
        <select id="track1-pitch">
            <option value="0">Do Not Play (i.e. 0 Hz)</option>
            <option value="200">200 Hz</option>
            <option value="245">245 Hz</option>
            <option value="290">290 Hz</option>
            <option value="335">335 Hz</option>
            <option value="380">380 Hz</option>
            <option value="425">425 Hz</option>
            <option value="470">470 Hz</option>
            <option value="515">515 Hz</option>
            <option value="560">560 Hz</option>
            <option value="605">605 Hz</option>
            <option value="650">650 Hz</option>
            <option value="695">695 Hz</option>
            <option value="740">740 Hz</option>
            <option value="785">785 Hz</option>
            <option value="830">830 Hz</option>
            <option value="875">875 Hz</option>
            <option value="920">920 Hz</option>
            <option value="965">965 Hz</option>
            <option value="1010">1010 Hz</option>
        </select>
    </div>

    <!-- Track 2 -->
    <div class="track-container">
        <h3>Track 2</h3>
        <label for="track2-duration">Select Beat Duration:</label>
        <select id="track2-duration">
            <option value="0.0625">1/16 second (i.e. 0.0625 second)</option>
            <option value="0.25">1/4 second (i.e. 0.25 second)</option>
            <option value="0.5">1/2 second (i.e. 0.5 second)</option>
            <option value="0.75">3/4 second (i.e. 0.75 second)</option>
            <option value="1">1 second</option>
            <option value="1.0625">17/16 seconds (i.e. 1.0625 second)</option>
            <option value="1.25">5/4 seconds (i.e. 1.25 seconds)</option>
            <option value="1.5">3/2 seconds (i.e. 1.5 seconds</option>
            <option value="1.75">7/4 seconds (i.e. 1.75 seconds)</option>
            <option value="2">2 seconds</option>
        </select>
        <br><br>
        <label for="track2-pitch">Select Beat Pitch:</label>
        <select id="track2-pitch">
            <option value="0">Do Not Play (i.e. 0 Hz)</option>
            <option value="200">200 Hz</option>
            <option value="245">245 Hz</option>
            <option value="290">290 Hz</option>
            <option value="335">335 Hz</option>
            <option value="380">380 Hz</option>
            <option value="425">425 Hz</option>
            <option value="470">470 Hz</option>
            <option value="515">515 Hz</option>
            <option value="560">560 Hz</option>
            <option value="605">605 Hz</option>
            <option value="650">650 Hz</option>
            <option value="695">695 Hz</option>
            <option value="740">740 Hz</option>
            <option value="785">785 Hz</option>
            <option value="830">830 Hz</option>
            <option value="875">875 Hz</option>
            <option value="920">920 Hz</option>
            <option value="965">965 Hz</option>
            <option value="1010">1010 Hz</option>
        </select>
    </div>

    <!-- Track 3 -->
    <div class="track-container">
        <h3>Track 3</h3>
        <label for="track3-duration">Select Beat Duration:</label>
        <select id="track3-duration">
            <option value="0.0625">1/16 second (i.e. 0.0625 second)</option>
            <option value="0.25">1/4 second (i.e. 0.25 second)</option>
            <option value="0.5">1/2 second (i.e. 0.5 second)</option>
            <option value="0.75">3/4 second (i.e. 0.75 second)</option>
            <option value="1">1 second</option>
            <option value="1.0625">17/16 seconds (i.e. 1.0625 second)</option>
            <option value="1.25">5/4 seconds (i.e. 1.25 seconds)</option>
            <option value="1.5">3/2 seconds (i.e. 1.5 seconds</option>
            <option value="1.75">7/4 seconds (i.e. 1.75 seconds)</option>
            <option value="2">2 seconds</option>
        </select>
        <br><br>
        <label for="track3-pitch">Select Beat Pitch:</label>
        <select id="track3-pitch">
            <option value="0">Do Not Play (i.e. 0 Hz)</option>
            <option value="200">200 Hz</option>
            <option value="245">245 Hz</option>
            <option value="290">290 Hz</option>
            <option value="335">335 Hz</option>
            <option value="380">380 Hz</option>
            <option value="425">425 Hz</option>
            <option value="470">470 Hz</option>
            <option value="515">515 Hz</option>
            <option value="560">560 Hz</option>
            <option value="605">605 Hz</option>
            <option value="650">650 Hz</option>
            <option value="695">695 Hz</option>
            <option value="740">740 Hz</option>
            <option value="785">785 Hz</option>
            <option value="830">830 Hz</option>
            <option value="875">875 Hz</option>
            <option value="920">920 Hz</option>
            <option value="965">965 Hz</option>
            <option value="1010">1010 Hz</option>
        </select>
    </div>

    <!-- Buttons to start and stop playing the beats -->
    <!-- <input type="button" class="green_button" onclick="startBeats()" value="START_BEATS"> -->
    <!-- <input type="button" class="green_button" onclick="startBeats()" value="STOP_BEATS"> -->

    <!-- Button to start playing the beats -->
    <button id="start_button" onclick="startBeats()">START_BEATS</button>
    <button id="stop_button" onclick="stopBeats()">STOP_BEATS</button>

    <script>
        let audioContext;
        let intervalIds = [];

        // Function to start the beats
        function startBeats() {
            // Initialize the audio context if not already created
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            // Start all three tracks
            startTrack(1);
            startTrack(2);
            startTrack(3);
        }

        // Function to stop all beats
        function stopBeats() {
            intervalIds.forEach(id => clearInterval(id)); // Clear all intervals
            intervalIds = []; // Reset interval ids array
        }

        // Function to start an individual track (trackNumber can be 1, 2, or 3)
        function startTrack(trackNumber) {
            const durationSelect = document.getElementById(`track${trackNumber}-duration`);
            const pitchSelect = document.getElementById(`track${trackNumber}-pitch`);

            const beatDuration = parseFloat(durationSelect.value);
            const beatPitch = parseFloat(pitchSelect.value);

            if (beatPitch === 0) return; // "Do Not Play" option selected, so don't play this track

            function playBeat() {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.frequency.value = beatPitch;
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(1, audioContext.currentTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + beatDuration);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + beatDuration);
            }

            // Set the interval to play the beat at the selected duration
            const intervalId = setInterval(playBeat, beatDuration * 1000);
            intervalIds.push(intervalId);
        }
    </script>
    <div class="console" id="console">???</div>
</body>
</html>